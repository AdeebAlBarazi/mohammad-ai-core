<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Become a Seller</title>
  <script>window.MARKET_API_BASE = window.MARKET_API_BASE || 'http://localhost:3002/api';</script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body{font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;margin:0;background:#f7fafc;color:#0f172a}
    .wrap{max-width:760px;margin:24px auto;padding:16px}
    h1{margin:0 0 16px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1 1 280px;min-width:260px}
    label{display:block;font-size:13px;margin-bottom:6px;color:#334155}
    input,select{width:100%;padding:10px;border:1px solid #cbd5e1;border-radius:8px}
    .actions{display:flex;gap:12px;margin-top:12px}
    button{padding:10px 14px;border-radius:8px;border:1px solid #0b3b5a;background:#0b3b5a;color:#fff;cursor:pointer}
    .muted{color:#64748b}
    .success{color:#065f46}
    .error{color:#b91c1c}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Become a Seller</h1>
    <div id="msg" class="muted"></div>
    <div class="card">
      <div class="row">
        <div class="col">
          <label for="spec">Seller Specialization</label>
          <select id="spec"></select>
        </div>
        <div class="col">
          <label for="bank_name">Bank Name</label>
          <input id="bank_name" />
        </div>
        <div class="col">
          <label for="bank_account">Account Number</label>
          <input id="bank_account" />
        </div>
        <div class="col">
          <label for="iban">IBAN</label>
          <input id="iban" />
        </div>
        <div class="col">
          <label for="swift">SWIFT (optional)</label>
          <input id="swift" />
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label for="phone">Phone</label>
          <div class="row">
            <div class="col"><input id="phone" /></div>
            <div class="col" style="flex:0 0 180px"><button id="otp_phone_send" type="button">Send OTP</button></div>
          </div>
          <div class="row">
            <div class="col"><input id="otp_phone" placeholder="OTP" /></div>
            <div class="col" style="flex:0 0 180px"><button id="otp_phone_verify" type="button">Verify Phone</button></div>
          </div>
        </div>
        <div class="col">
          <label for="email">Email</label>
          <div class="row">
            <div class="col"><input id="email" /></div>
            <div class="col" style="flex:0 0 180px"><button id="otp_email_send" type="button">Send OTP</button></div>
          </div>
          <div class="row">
            <div class="col"><input id="otp_email" placeholder="OTP" /></div>
            <div class="col" style="flex:0 0 180px"><button id="otp_email_verify" type="button">Verify Email</button></div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <label><input type="checkbox" id="legal" /> I agree to the terms, seller policy, and legal contract.</label>
          <label for="signature">Full Legal Name (optional)</label>
          <input id="signature" />
        </div>
      </div>
      <div class="actions">
        <button id="submit" type="button">Submit Application</button>
      </div>
    </div>
  </div>

  <script src="../js/market-common.js"></script>
  <script>
    (function(){
      const Common = window.Market && window.Market.Common;
      const $ = (id) => document.getElementById(id);
      const msg = (t, cls='muted')=>{ const el=$('msg'); el.className=cls; el.textContent=t; };
      function api(path, opt){ return fetch(Common.apiUrl(path), Object.assign({ headers:{'Accept':'application/json','Content-Type':'application/json'}}, opt||{})).then(async r=>({ ok:r.ok, body: await r.json().catch(()=>({})) })); }
      async function loadSpecs(){ const r = await api('/market/specializations'); const sel=$('spec'); sel.innerHTML=''; (r.body.items||[]).forEach(s=>{ const o=document.createElement('option'); o.value=s.id; o.textContent=s.name; sel.appendChild(o); }); }
      async function sendOtp(type){ const value = type==='phone'? $('phone').value.trim() : $('email').value.trim(); if(!value){ msg('Enter '+type+' first','error'); return; } const r = await api('/seller/upgrade/otp/request',{ method:'POST', body: JSON.stringify({ type, value }) }); if(r.ok){ const echo=r.body && r.body.dev_echo; msg('OTP sent'+(echo?(' (dev: '+echo+')'):'') ,'success'); } else { msg('Failed to send OTP','error'); } }
      async function verifyOtp(type){ const code = (type==='phone'? $('otp_phone').value : $('otp_email').value).trim(); if(!code){ msg('Enter OTP code','error'); return; } const r = await api('/seller/upgrade/otp/verify',{ method:'POST', body: JSON.stringify({ type, code }) }); if(r.ok && r.body.verified){ msg(type+' verified','success'); } else { msg('Invalid OTP','error'); } }
      async function submit(){ if(!$('legal').checked){ msg('You must accept the legal agreement','error'); return; } const payload={
          specialization_id: $('spec').value,
          bank_name: $('bank_name').value, bank_account: $('bank_account').value,
          iban: $('iban').value, swift: $('swift').value,
          phone: $('phone').value, email: $('email').value,
          legalAccepted: $('legal').checked, signature: $('signature').value
        };
        const r = await api('/seller/upgrade',{ method:'POST', body: JSON.stringify(payload) });
        if(r.ok){ msg('Application submitted. Status: pending','success'); }
        else { msg('Submit failed: '+(r.body && (r.body.error||'')),'error'); }
      }
      document.addEventListener('DOMContentLoaded', async ()=>{
        await (Common && Common.whenReady ? Common.whenReady() : Promise.resolve());
        await loadSpecs();
        $('otp_phone_send').onclick=()=>sendOtp('phone');
        $('otp_email_send').onclick=()=>sendOtp('email');
        $('otp_phone_verify').onclick=()=>verifyOtp('phone');
        $('otp_email_verify').onclick=()=>verifyOtp('email');
        $('submit').onclick=submit;
      });
    })();
  </script>
</body>
<script src="../js/auth-guard.js"></script>
</html>