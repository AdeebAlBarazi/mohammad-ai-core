<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>لوحة التحكم - المشرف</title>
  <script>window.MARKET_API_BASE = window.MARKET_API_BASE || 'http://localhost:3002/api';</script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body{font-family:Tajawal, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;margin:0;background:#f8fafc;color:#0f172a}
    header{background:#0b3b5a;color:#fff;padding:12px 16px;display:flex;align-items:center;gap:12px}
    header a{color:#fff;text-decoration:none;border:1px solid #93c5fd;padding:6px 10px;border-radius:8px}
    .wrap{max-width:1100px;margin:16px auto;padding:0 12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:14px}
    .card h3{margin:0 0 8px}
    .muted{color:#64748b}
    .pill{display:inline-block;padding:2px 8px;border:1px solid #cbd5e1;border-radius:999px}
    .warn{background:#fffbeb;border-color:#fdba74;color:#9a3412}
    .ok{background:#ecfdf5;border-color:#6ee7b7;color:#065f46}
    .links a{display:inline-block;margin:6px 6px 0 0;padding:8px 10px;border:1px solid #0b3b5a;border-radius:8px;text-decoration:none;color:#0b3b5a}
  </style>
</head>
<body>
  <header>
    <strong>لوحة التحكم - المشرف</strong>
    <span class="muted" id="who"></span>
    <span class="pill warn" id="role"></span>
    <span style="flex:1"></span>
    <a href="./marketplace-index.html">العودة للسوق</a>
  </header>
  <div class="wrap">
    <div class="grid">
      <div class="card"><h3>طلبات البائعين</h3><div class="muted">مراجعة واعتماد ورفض</div><div class="links"><a href="./admin-seller-requests.html">فتح الصفحة</a></div></div>
      <div class="card"><h3>إدارة الطلبات (شراء)</h3><div class="muted">مراقبة الطلبات، حالات الدفع والتسليم</div><div class="links"><a href="#" onclick="alert('قريبًا');return false;">قريبًا</a></div></div>
      <div class="card"><h3>طلبات المشترين</h3><div class="muted">استفسارات/شكاوى المشترين</div><div class="links"><a href="#" onclick="alert('قريبًا');return false;">قريبًا</a></div></div>
      <div class="card"><h3>إدارة المستخدمين</h3><div class="muted">أدوار وصلاحيات</div><div class="links"><a href="#" onclick="alert('قريبًا');return false;">قريبًا</a></div></div>
      <div class="card"><h3>إدارة السوق</h3><div class="muted">إضافة/حذف/تعديل بائعين</div><div class="links"><a href="#" onclick="alert('قريبًا');return false;">قريبًا</a></div></div>
      <div class="card"><h3>إعدادات الصلاحيات</h3><div class="muted">تعيين أدوار: سوبر/نائب/مساعد/مشرف</div><div class="links"><a href="#" onclick="alert('قريبًا');return false;">قريبًا</a></div></div>
    </div>
  </div>

  <script src="../js/market-common.js"></script>
  <script>
    (function(){
      const Common = window.Market && window.Market.Common;
      function api(p){ return fetch(Common.apiUrl(p), { headers:{'Accept':'application/json'} }).then(r=>r.json()); }
      async function guard(){
        try{ if(Common && Common.whenReady) await Common.whenReady(); }catch(_){}
        const me = await api('/market/auth/me');
        const who = document.getElementById('who');
        const role = document.getElementById('role');
        if(!me || me.authenticated !== true){ window.location.href = './marketplace-index.html'; return; }
        who.textContent = '— المستخدم: ' + (me.user && me.user.id || '');
        role.textContent = me.user && me.user.role || 'customer';
        if(!me.user || me.user.role !== 'super-admin'){ alert('هذه الصفحة للمشرف فقط'); window.location.href = './marketplace-index.html'; }
      }
      document.addEventListener('DOMContentLoaded', guard);
    })();
  </script>
</body>
<script src="../js/auth-guard.js"></script>
<script src="../js/role-guard.js"></script>
</html>