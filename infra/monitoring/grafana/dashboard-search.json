{
  "title": "Marketplace Search",
  "timezone": "browser",
  "panels": [
    {
      "type": "graph",
      "title": "Search Requests (Rate)",
      "targets": [
        {"expr":"rate(market_search_requests_total[5m])","legendFormat":"requests"}
      ],
      "lines": true
    },
    {
      "type": "graph",
      "title": "Zero Result Rate (%)",
      "targets": [
        {"expr":"(sum(rate(market_search_zero_results_total[5m])) / sum(rate(market_search_requests_total[5m]))) * 100","legendFormat":"zero %"}
      ],
      "lines": true
    },
    {
      "type": "graph",
      "title": "Fallback Success (%)",
      "targets": [
        {"expr":"(sum(rate(market_search_fallback_total[5m])) / sum(rate(market_search_zero_results_total[5m]))) * 100","legendFormat":"fallback success %"}
      ],
      "lines": true
    },
    {
      "type": "graph",
      "title": "p95 Search Latency (s)",
      "targets": [
        {"expr":"histogram_quantile(0.95, sum(rate(market_search_duration_seconds_bucket[5m])) by (le))","legendFormat":"p95"}
      ],
      "lines": true
    },
    {
      "type": "graph",
      "title": "p95 Fallback vs Normal (s)",
      "targets": [
        {"expr":"histogram_quantile(0.95, sum(rate(market_search_duration_seconds_bucket{fallback=\"0\"}[5m])) by (le))","legendFormat":"normal p95"},
        {"expr":"histogram_quantile(0.95, sum(rate(market_search_duration_seconds_bucket{fallback=\"1\"}[5m])) by (le))","legendFormat":"fallback p95"}
      ],
      "lines": true
    },
    {
      "type": "graph",
      "title": "Fallback Attempts (Rate)",
      "targets": [
        {"expr":"rate(market_search_fallback_total[5m])","legendFormat":"fallback"}
      ],
      "lines": true
    }
  ],
  "schemaVersion": 30,
  "version": 1
}
