# ุฎุทุฉ ุฌุงูุฒูุฉ ุงูุฅุทูุงู (Launch Readiness)

ูุฐู ุงููุซููุฉ ุชุฌูุน ุงููุชุทูุจุงุช ุงูุนูููุฉ ูุฅุทูุงู ุงูุฎุฏูุฉ ุจุซูุฉุ ูุชููุณ ุงูุฌุงูุฒูุฉ ููุงุจู ุฃูุฏุงู Sprint 3.

## 1) ุจูุฆุฉ Staging ูุทุงุจูุฉ ููุฅูุชุงุฌ
- ุงูุจููุฉ: ููุณ ุตูุฑุฉ Dockerุ ููุณ ูุชุบูุฑุงุช ุงูุจูุฆุฉุ ููุณ ุงููุณุทูุงุช ุงูุฃูููุฉ (CORS/CSP/Rate Limiting/HTTPS+HSTS)ุ ููุณ JWKS.
- ุงูุดุจูุฉ ูุงูุญุฏูุฏ: ููุณ ุงูู WAF/CDN (ููุงุนุฏ ููุงุฒูุฉ ุนูู ูุทุงู staging)ุ ููุงุณ latency ุนุจุฑ CDN.
- ุงูุณุฌูุงุช ูุงูููุงููุณ: ุชูุนูู Prometheus ุนูู `market` ู`auth`ุ ููุญุงุช ูุฑุงูุจุฉ ูุดุชุฑูุฉ.
- ุงูุตุญุฉ ูุงูุฌุงูุฒูุฉ: `/healthz`, `/readyz`, `/metrics` ููุนูุฉ ููุญููุฉ ููู ุงูุญุงุฌุฉ.

Check-list:
- [ ] ูุดุฑ ุตูุฑ Docker ุฐุงุช ูุณู ูุญุฏุฏ `market:<tag>` ู`auth:<tag>` ุนูู Staging.
- [ ] ุถุจุท `FORCE_HTTPS=1`, `ENABLE_CSP=1`, CORS whitelistุ HSTS ุจููุณ ููู ุงูุฅูุชุงุฌ.
- [ ] ุชูุนูู `METRICS_ENABLED=1` ูุฑุจุทูุง ุจููุญุงุช Grafana.
- [ ] JWKS ุนูู ููุณ ุงููุณุงุฑุงุช ูุน ููุงุชูุญ ูููุตูุฉ ูุจูุฆุฉ Staging.

## 2) ููุงุฑุณ Mongo ุงูุฃุณุงุณูุฉ
ุงูุชุฑุงุญุงุช ููููุฑุณุฉ ุญุณุจ ุงูุงุณุชุนูุงูุงุช ุงูุญุฑุฌุฉ:
- Products:
  - `{ sku: 1 }` ูุฑูุฏ
  - `{ vendorId: 1, countryCode: 1, createdAt: -1 }`
  - `{ category: 1, countryCode: 1, createdAt: -1 }`
- Orders:
  - `{ userId: 1, createdAt: -1 }`
  - `{ paymentStatus: 1, createdAt: -1 }` (ุงุฎุชูุงุฑู)
- Cart:
  - `{ userId: 1 }`
- Vendor:
  - `{ handle: 1 }` ูุฑูุฏ
  - `{ name: 1 }`

ุชูููุฐ ุณุฑูุน ุฏุงุฎู Mongo Shell:
```
db.products.createIndex({ sku: 1 }, { unique: true });
db.products.createIndex({ vendorId: 1, countryCode: 1, createdAt: -1 });
db.products.createIndex({ category: 1, countryCode: 1, createdAt: -1 });
db.orders.createIndex({ userId: 1, createdAt: -1 });
db.carts.createIndex({ userId: 1 });
db.vendors.createIndex({ handle: 1 }, { unique: true });
db.vendors.createIndex({ name: 1 });
```

## 3) SLOs ููุฃุฏุงุก ูุงูุชูุงูุฑ
ููุชุฑุญ ุฃููู (ูููู ุถุจุทู ุจุนุฏ ุงูููุงุณ):
- ุงูุชูุงูุฑ ุงูุดูุฑู: โฅ 99.9%
- ุฒูู ุงุณุชุฌุงุจุฉ p95:
  - `GET /api/v1/market/products`: โค 300ms
  - `POST /api/v1/market/orders`: โค 500ms
  - `POST /api/v1/market/cart`: โค 250ms

PromQL ุฃูุซูุฉ:
```
histogram_quantile(0.95, sum(rate(market_http_request_duration_seconds_bucket[5m])) by (le, route))
sum(rate(market_http_requests_total{status=~"5.."}[5m]))
```

ุชูุจููุงุช:
- 5xx ููู ุงูุนุชุจุฉ ูู 5 ุฏูุงุฆู.
- p95 ูุชุฌุงูุฒ ุงููุฏู ูู 10 ุฏูุงุฆู.

## 4) ุงุฎุชุจุงุฑุงุช ุชุญููู ูู Staging
- ุฃุฏุงุฉ ููุชุฑุญุฉ: k6 (ุฃู Locust/JMeter).
- ุณููุงุฑูููุงุช: ุชุตูุญ ุงูููุชุฌุงุชุ ุฅุถุงูุฉ ููุณูุฉุ ุฅูุดุงุก ุทูุจุ ุงุณุชุนุฑุงุถ ุงูุทูุจุงุช.
- ุฃูุฏุงู: ุงูุชุฃูุฏ ุฃู p95 ุถูู ุงูุฃูุฏุงู ุนูุฏ N RPS ูุชููุนุฉ + ูุงูุด ููู.

ูุซุงู k6 ูุจุณูุท:
```
import http from 'k6/http';
import { sleep } from 'k6';
export const options = { vus: 50, duration: '5m' };
export default function () {
  http.get(`${__ENV.BASE_URL}/api/v1/market/products`);
  sleep(1);
}
```

## 5) ุขููุฉ Rollback (Blue/Green ุฃู Canary)
- Blue/Green:
  - ูุดุฑ `vNext` ุนูู ุจูุฆุฉ ุฎุถุฑุงุก ูุน ููุณ ููุงุนุฏ WAF/CDN.
  - ูุญูุตุงุช ุตุญุฉ/ุฌุงูุฒูุฉ ูุชูุฑูุฑ ุงุฎุชุจุงุฑุงุช ุฏุฎุงููุฉ.
  - ุชุญููู ุงูุชุฑุงููู ุชุฏุฑูุฌููุง ุนุจุฑ ุงูู LB/CDN.
  - ุฅู ุธูุฑุช ูุดุงูู: ุฅุฑุฌุงุน ุงูุชูุฌูู ุฅูู ุงูุฅุตุฏุงุฑ ุงูุฃุฒุฑู ููุฑูุง.
- Canary:
  - ุชูุฒูุน ูุณุจุฉ ุตุบูุฑุฉ (5-10%) ุฅูู ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ ูุน ูุฑุงูุจุฉ ููุงููุณ ุงูุฃุฎุทุงุก ูุงูู p95.
  - ุฒูุงุฏุฉ ุงููุณุจุฉ ุชุฏุฑูุฌููุง ุนูุฏ ุงูุงุณุชูุฑุงุฑ.

Runbook ูุฎุชุตุฑ:
1. ุจูุงุก ุงูุตูุฑ Tagged ูุฏูุนูุง ููุฑูุฌุณุชุฑู.
2. ูุดุฑ ุนูู Green ูุน ููุณ secrets/env.
3. ุงูุชุญูู ูู `/readyz` ู`/metrics`.
4. ุชุญููู 10% โ 50% โ 100% ูุน ูุฑุงูุจุฉ.
5. ุนูุฏ ุงููุดู: ุฅุนุงุฏุฉ ุงูุชูุฌูู ููุฅุตุฏุงุฑ ุงูุณุงุจู ููุฑูุง.

## 6) ุงูุฎุตูุตูุฉ ูุงูุงูุชุซุงู (PII)
- ุฌุฑุฏ PII: ุงูุงุณูุ ุงูุจุฑูุฏุ ุงููุงุชูุ ุงูุนูุงูููุ ุงููุนุฑูุงุช.
- ุงูุงุญุชูุงุธ (Retention):
  - ุงูุณุฌูุงุช ุงูุชุดุบูููุฉ: 30-90 ููููุง (ูุน ุชูููุญ PII).
  - ุจูุงูุงุช ุงูุทูุจุงุช: ููู ุงูุงูุชุซุงู ุงููุงูู (ูุซูุงู 5-7 ุณููุงุช) ูุน ุชุดููุฑ ุนูุฏ ุงูุฑุงุญุฉ.
- ุงููุณุญ/ุงููุญู (Erasure/DSR): ุฅุฌุฑุงุก ููุญู ุจูุงูุงุช ุงููุณุชุฎุฏู ุนูุฏ ุงูุทูุจุ ูุชุถูู ุงูุณุฌูุงุช ุงููุณุงูุฏุฉ ูุฏุฑ ุงูุฅููุงู.
- ุงูุชุดููุฑ: at-rest (Mongo/ุฃูุฑุงุต) ูin-transit (HTTPS ููุท).
- ุงูุชูููุญ: ููุนูู ูู ุงูุชุณุฌูู (ุฅุฎูุงุก ุงูุจุฑูุฏ/ุงููุงุชู/ุงูุฑููุฒ ุงูุญุณุงุณุฉ).

## 7) ุญุงูุฉ ุงูุฌุงูุฒูุฉ ููุงุจู ุฃูุฏุงู Sprint 3
- Staging ูุทุงุจูุฉ: ุฌุฒุฆููุง โ ููุฒู ุชุซุจูุช ุจูุฆุฉ Staging ูุนููุฉ ุจููุณ ุงูุฅุนุฏุงุฏุงุช ุงูุฃูููุฉ ูJWKSุ ูุฑุจุท ุงููุฑุงูุจุฉ.
- ููุงุฑุณ Mongo: ููุฏ ุงูุฅูุฑุงุฑ โ ุฃุถููุง ูุฒุงููุฉ ุชููุงุฆูุฉ ููููุงุฑุณุ ููู ููุฒู ุชุซุจูุช ุงูููุงุฑุณ ุงููุฐููุฑุฉ ูุงูุชุญูู ูููุง ูุนูููุง.
- SLOs: ููุชุฑุญุฉ โ ุชุญุชุงุฌ ุงุนุชูุงุฏ ููุงุฆู ูุชุดุบูู ุงุฎุชุจุงุฑุงุช ุชุญููู ูู Staging ููุชุญูู.
- Rollback: ููุซู โ ูุญุชุงุฌ Runbook ูุฌุฑูุจ (ุชูุฑูู ุนููู) ูุน ุตูุฑ Tagged ูุชุญููู ุชุฏุฑูุฌู ุนุจุฑ CDN/LB.
- ุงูุฎุตูุตูุฉ: ุงูุฃุณุงุณุงุช ููุฌูุฏุฉ (ุชูููุญ ุงูุณุฌูุงุชุ ุฅุนุฏุงุฏุงุช ุฃูุงู)ุ ูุญุชุงุฌ ูุซููุฉ ุณูุงุณุฉ ุงุญุชูุงุธ/ูุญู ูุนุชูุฏุฉ ูุฅุฌุฑุงุก ุชุดุบููู.

## 8) ุงูุฎูุงุตุฉ: ูู ูุญู ุฌุงูุฒููุ
ุฌุงูุฒูู ุจูุณุจุฉ ูุจูุฑุฉ ูุธููููุง ูุฃููููุงุ ููู ูุญุชุงุฌ ุชูููุฐ ุงูุจููุฏ ุงูุชุงููุฉ ูุจู ุฅุนูุงู ุงูุฌุงูุฒูุฉ ุงูููุงุฆูุฉ ููุฅุทูุงู:
1) ุฅูุดุงุก ููุดุฑ ุจูุฆุฉ Staging ูุชูุงูุฆุฉ ูุฅุฌุฑุงุก ุงุฎุชุจุงุฑุงุช ุงูุชุญููู.
2) ุชุซุจูุช ุงูููุงุฑุณ ุงูููุชุฑุญุฉ ูุงูุชุญูู ูู ุฃุฏุงุก ุงูุงุณุชุนูุงูุงุช (p95) ุถูู ุงูุญุฏูุฏ.
3) ุฅูุฑุงุฑ SLOs ุงูููุงุฆูุฉ ูุฅุถุงูุฉ ุชูุจููุงุช Prometheus.
4) ุชูููุฐ ุชูุฑูู Rollback (Blue/Green ุฃู Canary) ูุงูุชูุซูู.
5) ุงุนุชูุงุฏ ุณูุงุณุฉ ุงูุฎุตูุตูุฉ ูุงูุงุญุชูุงุธ ูุงููุญู.

ุจุนุฏ ุฅุชูุงู ูุฐู ุงูุจููุฏ ูุชุซุจูุช ูุชุงุฆุฌูุงุ ูููู ุงุนุชุจุงุฑ ุงููุธุงู ุฌุงูุฒูุง ููุฅุทูุงู.
ูุง ุณูุงู ๐
ููุงุญุธุงุชู ููุณูุง ุชุตูุญ ุชููู โูุณุฎุฉ 2.0โ ูู ุฎุทุฉ ุงูุฌุงูุฒูุฉ ููุฅูุชุงุฌ โ ูููุง ูุถุฌ ุนุงูู (Authุ ูุณุงุฆุทุ ููุงุฑุณุ ุงูุชุซุงูโฆ ุฅูุฎ).
ุณุฃุนูู ุงูุขู ุดูุฆูู:

1. **ุฃุฑุชูุจ ููุงุญุธุงุชู ูู ุฎุทุฉ ุนูู ููุงุฆูุฉ ูุญุณููุฉ (ูุฑูุฏูุงุจ + Sprints)**
2. **ุฃุนุทูู ููู ุชูุซูู ุฌุงูุฒ ุจุตูุบุฉ Markdown** ุชุถุนู ูู GitHub ูุซู `docs/PRODUCTION_READINESS_PLAN.md`

---

## ุฃููุงู: ุฎุทุฉ ุนูู ููุงุฆูุฉ ูุญุณููุฉ (Sprints ุนูููุฉ)

### ๐ฏ ุงููุฏู ุงูุนุงู

ุงูุงูุชูุงู ูู **ูุณุฎุฉ ุฏููู** ุฅูู **ููุตุฉ ุณูู ุฌุงูุฒุฉ ููุฅูุชุงุฌ** ูุน:

* ุฃูุงู ุญูููู (JWT + RBAC + ูุณุงุฆุท + CORS/CSP/Rate Limit)
* ูุงุจููุฉ ุชุดุบูู ููุฑุงูุจุฉ (Logs + Health + Docker + CI/CD)
* ุฃุฏุงุก ุฌูุฏ (ููุฑุณุฉุ Paginationุ Cache)
* ุฎุทุฉ ุฅุทูุงู + Rollback ูุงุถุญุฉ

ุณุฃุฑุชูุจูุง ูุณูุณูุฉ Sprints ููููู ุชูููุฐูุง ุฎุทูุฉ ุจุฎุทูุฉ.

---

### ๐จ Sprint 0 โ ุงูุฅููุงุฐ ูุงูุชุซุจูุช (Stabilization & Versioning)

**ุงููุฏู:** ุงููุธุงู ูุนูู ุจุฏูู crashesุ ููุณุงุฑุงุช ูุงุถุญุฉุ ูAPI ููุธูู.

#### ุงูููุงู:

1. **ุฅุตูุงุญ ุงูุงุณุชูุฑุงุฏุงุช ูุงููุณุงุฑุงุช ุงูููุณูุฑุฉ**

   * `market-server.js`:

     * ุฅุตูุงุญ/ุฅุนุงุฏุฉ ูุณุงุฑ `./systems/config/env/loader`
     * ุชุบููู ุชุญููู ุงูู loader ุจู `try/catch` + fallback ุฅูู `dotenv.config()`.
   * `server.js`:

     * ุชุตุญูุญ ุงุณุชูุฑุงุฏ ุงูู `authMiddleware` ุฅูู ุงููุณุงุฑ ุงูุตุญูุญ ุงููุนูู.
   * `tenants.json`:

     * ุชูุญูุฏ ุงููุณุงุฑ ุจูู ุงูููุฏ ูุงูููู ุงููุนูู.

2. **ุชูุญูุฏ ููุทุฉ ุงูุฏุฎูู**

   * ุงุนุชูุงุฏ `server.js` ูู **Entry Point ุงูุฑุณูู**.
   * ุชุนุฏูู ุณูุฑุจุชุงุช `package.json`:

     ```jsonc
     {
       "scripts": {
         "start": "node server.js",
         "dev": "nodemon server.js",
         "start:market:legacy": "node market-server.js"
       }
     }
     ```
   * ูุถุน ุชุนููู ูู `market-server.js` ุจุฃูู Legacy ููุท ููุชุฌุงุฑุจ.

3. **ุชูุญูุฏ Versioning ููู API**

   * ููู ุฃู ุชุนุฑูู ุงููุณุงุฑุงุช ุชุญุช:

     * `/api/v1/market/...`
     * `/api/v1/auth/...`
     * `/api/v1/cart/...`
   * ุฅุนุฏุงุฏ Redirect ุฏุงุฎูู ูุคูุช ูู ูู ูุณุงุฑุงุช ูุฏููุฉ (ุงุฎุชูุงุฑู).

4. **Pagination + Limit**

   * ูุฑุถ:

     * `limit <= 100` ูู ูู Endpoints ุงูุชู ุชุนูุฏ ูุงุฆูุฉ (products, ordersโฆ).
   * ุฅุฑุฌุงุน ุฎุทุฃ ูุงุถุญ ุฅุฐุง ุชุฌุงูุฒ ุงูุญุฏ:

     ```json
     { "error": "MAX_LIMIT_EXCEEDED", "max": 100 }
     ```

> โ ุจููุงูุฉ Sprint 0:
>
> * ุฎุงุฏู ูุงุญุฏ ุฑุณูู (server.js).
> * ูุง ููุฌุฏ imports ููุณูุฑุฉ.
> * API ููุญูุฏ ุชุญุช `/api/v1`.
> * ูุง ุชูุฌุฏ ุงุณุชุนูุงูุงุช ุจูุง ุณูู (Pagination ูุถุจูุท).

---

### ๐ก Sprint 1 โ ุงูุฃูุงู ูุงูุจููุฉ ุงูุชุญุชูุฉ (Security & Infra)

**ุงููุฏู:** ุชุฃููู ูู ูุง ูุชุนูู ุจุงููุณุชุฎุฏูุ ุงูุฌูุณุงุชุ ุงููุณุงุฆุทุ ูุงูุทุจูุงุช ุงูุฎุงุฑุฌูุฉ.

#### 1) Auth + JWT + RBAC

1. **ุชุทุจูู JWT ุจููุงุชูุญ ุบูุฑ ูุชูุงุซูุฉ (RS256)**

   * ุฅูุดุงุก ุฒูุฌ ููุงุชูุญ:

     * `JWT_PRIVATE_KEY` (ูุฎุฒูู ูู Secrets Manager ููุท)
     * `JWT_PUBLIC_KEY` (ูููู ูุดุฑู ูู ุงูุจูุฆุฉ)
   * ุชูููุน ุงูุชููู ุจู RS256:

     ```js
     jwt.sign(payload, privateKey, { algorithm: 'RS256', expiresIn: '1h' });
     ```

2. **ุชุฏููุฑ ุงูููุงุชูุญ (Key Rotation)**

   * ุชุตููู ุญูู `kid` ูู Header ููุชููู.
   * ุฅููุงููุฉ ุงูุงุญุชูุงุธ ุจููุชุงุญูู ููุชุฑุฉ ุงูุชูุงููุฉ.
   * ุงูุชุฎุฒูู ูู **Secrets Manager** (AWS / Azure / Vault) ูููุณ `.env` ุนูู ุงูุณูุฑูุฑ.

3. **RBAC**

   * ูููู ุฃุฏูุงุฑ: `user`, `seller`, `admin`.
   * Middleware:

     * `requireAuth`
     * `requireRole('seller')`
     * `requireRole('admin')`
   * ุชุทุจูููุง ุนูู:

     * `cart/*`
     * `orders/*`
     * `seller/*`
     * `media/upload`
     * `admin/*`

#### 2) ุงูุชุญูู ูู ุงูููุฏุฎูุงุช (Input Validation)

* ุงุนุชูุงุฏ ููุชุจุฉ ููุญุฏุฉ:

  * ูุซู Zod ุฃู express-validator.
* ุฅูุดุงุก Schemas ููู Endpoint:

  * `POST /products`
  * `POST /cart`
  * `POST /orders`
  * `POST /seller/products`
* ุฅุฑุฌุงุน ุฑุณุงุฆู ุฃุฎุทุงุก ุซุงุจุชุฉ ุงูุดูู:

  ```json
  {
    "error": "VALIDATION_ERROR",
    "details": [
      { "field": "price", "message": "Price must be positive number" }
    ]
  }
  ```

#### 3) ุงููุณุงุฆุท (Media Storage)

1. **ุงูููู ุฅูู S3/Blob**

   * ุฅุนุฏุงุฏ Bucket ูุน:

     * ุณูุงุณุฉ ุฃูุงู (Private by default).
   * ุชุญุฏูุซ `mediaStorage`:

     * `upload(file) โ key`
     * `getSignedUrl(key, ttl)` ุนูุฏ ุงูุญุงุฌุฉ.

2. **ุชูุนูู ุชูููุน ุงูุฑูุงุจุท**

   * `MEDIA_SIGNING_ENABLED=1`
   * ุงุณุชุฎุฏุงู signed URLs ูุน TTL.

3. **ูููุฏ ุงููุณุงุฆุท**

   * ุญุฌู ุงูููู: `<= 5MB`
   * ุงูุฃููุงุน ุงููุณููุญุฉ: `image/jpeg`, `image/png`, `image/webp`
   * (ุงุฎุชูุงุฑู) ูุญุต AntiVirus ูุจู ูุจูู ุงูููู.

4. **ุฎุฏูุฉ Thumbnails**

   * ุฅููุง:

     * ูุฒุฌ Sharp ูุจุงุดุฑุฉ ุจุนุฏ ุงูุฑูุน.
     * ุฃู ุฅุนุฏุงุฏ ุฎุฏูุฉ/Job ูููุตูุฉ ุชูููุฏ:

       * Thumb
       * Medium
       * Large

#### 4) CORS + CSP + Rate Limit + HTTPS

1. **CORS**

   * ุญุตุฑ Origins ุฅูู:

     * ูุทุงู ุงููุงุฌูุฉ ุงูุฑุณูู.
     * ูุทุงู ููุญุฉ ุงูุฅุฏุงุฑุฉ (ูู ูุฎุชูู).

2. **CSP**

   * ุชูุนูู Helmet ูุน ุณูุงุณุฉ ูุงูุนูุฉ:

     * `default-src 'self'`
     * `img-src 'self' data: https://<storage-domain>`
     * `script-src 'self' https://cdn...`
   * ุชุญุฏูุซ ุญุณุจ ุงูุฃุตูู ุงูุชู ุชุณุชุฎุฏููุง.

3. **Rate Limiting**

   * ุฒูุงุฏุฉ ุงูู rate limit ููุดูู:

     * `/auth/*`
     * `/orders/*`
     * `/cart/*`
     * `/upload/*`

4. **HTTPS + HSTS**

   * ูู ุงูู Traffic ูููู ุนุจุฑ HTTPS ุฎูู Nginx/Proxy.
   * ุชูุนูู HSTS.
   * ุงุณุชุฎุฏุงู Cookies (ุฅู ุงุณุชูุฎุฏูุช) ุจู:

     * `HttpOnly`
     * `Secure`
     * `SameSite=Lax`

5. **WAF / CDN**

   * ูุถุน ุงููุงุฌูุฉ ูุงูู API ุฎูู:

     * Cloudflare / AWS WAF
   * ุชูุนูู ููุงุนุฏ ุฃุณุงุณูุฉ ุถุฏ:

     * XSS
     * SQL/NoSQL injection patterns
     * DDoS ุจุณูุท

> โ ุจููุงูุฉ Sprint 1:
>
> * Auth ุขูู (RS256 + RBAC).
> * ุฑูุน ุงููุณุงุฆุท ุนูู S3/Blob ููููุน.
> * CORS/CSP/Rate Limit/HTTPS ููุนููุฉ.

---

### ๐ Sprint 2 โ ุงูุฌูุฏุฉ ูุงูุนูููุงุช (Quality & Ops)

**ุงููุฏู:** ุฌุนู ุงูุชุดุบูู ูุงููุฑุงูุจุฉ ูุงูุตูุงูุฉ ุงุญุชุฑุงููุฉ.

#### 1) Logs + Health + Monitoring

1. **Logger ููุธู**

   * ุงุณุชุฎุฏุงู `pino` ุฃู `winston`:

     * ุตูุบุฉ JSON:

       ```json
       { "level": "info", "msg": "order_created", "orderId": "...", "userId": "..." }
       ```
   * ุงุณุชุฎุฏุงู Correlation ID:

     * ุฅูุง ูู Header `X-Request-Id`
     * ุฃู ุชูููุฏู ููู ุทูุจ.

2. **ุฅุฎูุงุก PII ูู ุงูุณุฌูุงุช**

   * ูุง ุชูุณุฌูู:

     * Email, Phone, ุฃุณูุงุก ูุงููุฉุ Tokens.
   * ูููู ุชุณุฌูู `userId` ููุท.

3. **Health Endpoints**

   * `/healthz`:

     * ุงูุฎุฏูุฉ ุดุบุงูุฉ.
   * `/readyz`:

     * ุงุชุตุงู DB ูููููุงุช ุฃุณุงุณูุฉ ุฌุงูุฒุฉ.

4. **ููุงููุณ (Metrics)**

   * Prometheus Exporter:

     * ุนุฏุฏ ุงูุทูุจุงุช.
     * ุฒูู ุงูุงุณุชุฌุงุจุฉ.
     * ุฃุฎุทุงุก 4xx / 5xx.
     * ุงุณุชููุงู ููุงุฑุฏ ุฃุณุงุณู.

#### 2) Docker + PM2 + CI/CD

1. **Dockerfile**

   * ุงุณุชุฎุฏุงู `node:20-alpine`.
   * ุชุดุบูู ูู user `node` ูููุณ root.
   * ุฅุถุงูุฉ `HEALTHCHECK` ูุณุชุฏุนู `/healthz`.

2. **docker-compose.yml**

   * Services:

     * app (API)
     * Mongo (ูููุถุน ุงููุญูู ุฃู Staging)
     * MinIO (ูู ุชูุญุงูู S3 ูุญูููุง).

3. **PM2 (ุฅู ุงุญุชุฌุช)**

   * `ecosystem.config.js` ูุนุฏุฏ Instances ูุชุญูู ุจุงูุจูุฆุฉ.

4. **CI Pipeline**

   * Jobs:

     1. `npm install`
     2. `npm run lint`
     3. `npm test`
     4. `npm audit` ุฃู ูุญุต SAST ุจุณูุท
     5. `docker build`
     6. ูุญุต ุงูุตูุฑุฉ ุงูุฃูููุฉ (Trivy)

5. **ุงุฎุชุจุงุฑุงุช**

   * Unit Tests ููุณุงุฑุงุช ุฑุฆูุณูุฉ.
   * **Smoke E2E** ุนุจุฑ:

     * Postman/Newman ุฃู K6:

       * ูุณุชุฎุฏู: ุชุตูุญ โ ุนุฑุจุฉ โ ุทูุจ.
       * ุจุงุฆุน: ุฅูุดุงุก ููุชุฌ โ ุฑูุน ุตูุฑ โ ุญุฐู.

---

### ๐ Sprint 3 โ ุงูุฅุทูุงู (Launch)

**ุงููุฏู:** ุชุฌููุฒ Staging = Production ุชูุฑูุจูุงุ ูุชุญูู SLOsุ ูุชุนุฏ ุฎุทูุฉ Rollback.

#### ุงูููุงู:

1. **Staging ูุงูุนู**

   * ููุณ ุฅุนุฏุงุฏุงุช ุงูุฅูุชุงุฌ ุชูุฑูุจูุง:

     * Auth
     * S3/Blob
     * CORS/CSP
     * ููุงุฑุณ DB

2. **ุงูููุงุฑุณ (Mongo)**

   * `MpProduct`:

     * `{ countryCode:1, active:1, createdAt:-1 }`
     * `{ countryCode:1, active:1, price:1 }`
     * `text index` ุนูู `name`, `material` ุนูุฏ ุงุณุชุฎุฏุงู ุจุญุซ ูุตู.
   * `MpOrder`:

     * `{ user:1, createdAt:-1 }`
     * `{ paymentStatus:1 }`
   * `MpCart`:

     * `{ userKey:1, countryCode:1 }`
   * `MpVendor`:

     * ุงูุญูุงุธ ุนูู ุงูููุงุฑุณ ุงููุฑูุจุฉ ุงูุญุงููุฉ ุฅู ูุงูุช ุฌูุฏุฉ.

3. **ุงูุฃุฏุงุก (SLOs)**

   * SLO ููุชุฑุญ:

     * `p95` ูุฒูู `/api/v1/market/products?page=1` โค 300ms ูู Staging.
     * ุชููุฑ โฅ 99.9%.

4. **Plan B / Rollback**

   * ุงุนุชูุงุฏ ุฃุณููุจ:

     * Blue/Green ุฃู Canary.
   * ุงููุฏุฑุฉ ุนูู:

     * ูุดุฑ ูุณุฎุฉ ุฌุฏูุฏุฉ.
     * ุงูุฑุฌูุน ุจุณุฑุนุฉ ูููุณุฎุฉ ุงูุณุงุจูุฉ ุจุถุบุทุฉ (Rollback ุณุฑูุน).

5. **ุงูุงูุชุซุงู ูุฎุตูุตูุฉ ุงูุจูุงูุงุช**

   * ุณูุงุณุฉ ุงุญุชูุงุธ ูููุณุงุฆุท.
   * ุขููุฉ ุญุฐู ุจูุงูุงุช ุงููุณุชุฎุฏู ุนูุฏ ุงูุทูุจ (Right to Erasure).
   * ุฅุฎูุงุก PII ูู ุงูู Logs.
   * ุชูุซูู ูุฎุชุตุฑ ุนู ุชูุงูู ูุน GDPR/LGPD (ุฅู ูุฑุชุจุท ุจุงูุฃุณูุงู ุงูุชู ุชุณุชูุฏููุง).

---

## ุซุงููุงู: ุชูุซูู ุฌุงูุฒ ูู GitHub (Markdown)

ููููู ุฅูุดุงุก ููู ุฌุฏูุฏ ูุซูุงู:
`docs/PRODUCTION_READINESS_PLAN.md`

### โ๏ธ ูุต ุฌุงูุฒ ูููุณุฎ:

```markdown
# ุฎุทุฉ ุฌุงูุฒูุฉ ุงูุฅูุชุงุฌ (Production Readiness Roadmap)

ูุฐู ุงููุซููุฉ ุชูุซูู ุฎุทุฉ ุชุญููู ูุธุงู ุงูุณูู ูู ูุณุฎุฉ ุชุทููุฑ/ุฏููู ุฅูู ูุณุฎุฉ ุฌุงูุฒุฉ ููุฅุทูุงู ูุงูุฅูุชุงุฌุ ุนุจุฑ ุณูุณูุฉ Sprints ูุงุถุญุฉ.

---

## ูุธุฑุฉ ุนุงูุฉ

- **ุงูุญุงูุฉ ุงูุญุงููุฉ:** ุงููุดุฑูุน ูุนูู ููุณุฎุฉ ุชุทููุฑ/ุนุฑุถุ ูุน ุนูุงุฆู ุชููุน ุงูุฅุทูุงู ุงูุฅูุชุงุฌู ุงููุจุงุดุฑ.
- **ุงููุฏู:** ุงููุตูู ุฅูู ููุตุฉ ุณูู:
  - ุขููุฉ (Auth + RBAC + ูุณุงุฆุท ููููุนุฉ)
  - ูุงุจูุฉ ููุชุดุบูู ูุงููุฑุงูุจุฉ
  - ุจุฃุฏุงุก ูููุงุฑุณ ููุงุณุจุฉ
  - ุจุฎุทุฉ ูุดุฑ ูRollback ูุงุถุญุฉ

---

## Sprint 0 โ ุงูุฅููุงุฐ ูุงูุชุซุจูุช (Stabilization & Versioning)

**ุงูุฃูุฏุงู:**

- ุฅุฒุงูุฉ ุงูุงุณุชูุฑุงุฏุงุช ุงูููุณูุฑุฉ.
- ุชูุญูุฏ ููุทุฉ ุงูุฏุฎูู ูู ุฎุงุฏู ูุงุญุฏ (`server.js`).
- ุชูุญูุฏ Versioning ุชุญุช `/api/v1`.
- ูุฑุถ ุณูู Pagination.

**ููุงุท ุงููุฌุงุญ (Success Criteria):**

- ูุง ููุฌุฏ crash ุจุณุจุจ import ููุณูุฑ.
- `server.js` ูู Entry Point ุงููุญูุฏ ููุฅูุชุงุฌ.
- ุฌููุน ุงูู APIs ุชุญุช `/api/v1/...`.
- ุฌููุน ุงูููุงุฆู ุชุณุชุฎุฏู `limit` ุจุณูู โค 100.

---

## Sprint 1 โ ุงูุฃูุงู ูุงูุจููุฉ ุงูุชุญุชูุฉ (Security & Infra)

**ุงูุฃูุฏุงู:**

- ุชุฃููู ุงููุตุงุฏูุฉ ูุงููููุฉ ุนุจุฑ JWT RS256 ูุน ุชุฏููุฑ ุงูููุงุชูุญ.
- ูุฑุถ RBAC ุนูู ุฌููุน ูุณุงุฑุงุช ุงููุชุงุจุฉ.
- ุงูุงูุชูุงู ุฅูู ุชุฎุฒูู ูุณุงุฆุท S3/Blob ุจุฑูุงุจุท ููููุนุฉ.
- ุชูููุฏ CORSุ ุชูุนูู CSPุ ูุชุทุจูู Rate Limiting ุดุงูู.
- ุถูุงู HTTPS ูHSTS ููุถุน ุงููุธุงู ุฎูู WAF/CDN.

**ููุงุท ุงููุฌุงุญ:**

- ุฌููุน ูุณุงุฑุงุช ุงููุชุงุจุฉ ูุญููุฉ ุจู `requireAuth + requireRole`.
- ูุง ููุฌุฏ ุชุฎุฒูู Tokens ูู ูููุงุช ุฃู Logs.
- ุงููุณุงุฆุท ุชูุฎุฒูู ูู S3/Blob ูุน `MEDIA_SIGNING_ENABLED=1`.
- CORS/CSP/Rate Limiting ููุนููุฉ ุนูู ุงููุณุงุฑุงุช ุงูุญุณุงุณุฉ.

---

## Sprint 2 โ ุงูุฌูุฏุฉ ูุงูุนูููุงุช (Quality & Operations)

**ุงูุฃูุฏุงู:**

- ุงุณุชุฎุฏุงู Logger ููุธู (JSON + Correlation IDs) ูุน ุฅุฎูุงุก PII.
- ุฅุถุงูุฉ `/healthz` ู`/readyz` ูุชุณูุฉ.
- ุฅุนุฏุงุฏ Dockerfile ูdocker-compose ูHEALTHCHECK.
- ุฅุนุฏุงุฏ CI (lint + test + audit + docker build + image scan).
- ุฅุถุงูุฉ ุงุฎุชุจุงุฑุงุช ูุญุฏุฉ ูุชูุงูู ูSmoke E2E ุฃุณุงุณูุฉ.

**ููุงุท ุงููุฌุงุญ:**

- Logs ููุธูุฉ ููุงุจูุฉ ููุชุฌููุน ูู ูุธุงู ูุฑูุฒู.
- ูุฑุงูุจุฉ ุงูุตุญุฉ ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ูุน Orchestrator ุฃู Load Balancer.
- Pipeline CI ูุนูู ุชููุงุฆููุง ุนูุฏ ุงูู push.
- ุชูุฑูุฑ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุงูุฃุณุงุณูุฉ ูุจู ุฃู ูุดุฑ.

---

## Sprint 3 โ ุงูุฅุทูุงู (Launch Readiness)

**ุงูุฃูุฏุงู:**

- ุฅูุดุงุก ุจูุฆุฉ Staging ูุทุงุจูุฉ ูุฏุฑ ุงูุฅููุงู ููุฅูุชุงุฌ.
- ุถุจุท ููุงุฑุณ Mongo ุงูุฃุณุงุณูุฉ (Products, Orders, Cart, Vendor).
- ุชุนุฑูู SLOs ููุฃุฏุงุก ูุงูุชูุงูุฑุ ูุงุฎุชุจุงุฑูุง ูู Staging.
- ุฅุนุฏุงุฏ ุขููุฉ Rollback (Blue/Green ุฃู Canary).
- ุชูุซูู ุณูุงุณุงุช ุงูุฎุตูุตูุฉ ูุงูุงูุชุซุงู (Retention, PII, Erasure).

**ููุงุท ุงููุฌุงุญ:**

- Staging ุชุนูุณ ูุงูุน ุงูุฅูุชุงุฌ (ููุณ ุงูุจููุฉ + ููุณ ุงูุฅุนุฏุงุฏุงุช ุงูุฃูููุฉ ุชูุฑูุจูุง).
- ุงุณุชุนูุงูุงุช ุงูููุชุฌุงุช ูุงูุทูุจุงุช ุณุฑูุนุฉ (p95 ููุทูุจุงุช ุงูุญุฑุฌุฉ ุถูู ุงูุญุฏูุฏ ุงููุชูู ุนูููุง).
- ูุดุฑ ูุณุฎุฉ ุฌุฏูุฏุฉ ูุชุถูู ุฎุทุฉ ุฑุฌูุน ูุงุถุญุฉ ูุณุฑูุนุฉ.
- ุงูุงูุชุซุงู ูุณูุงุณุงุช ุงูุฎุตูุตูุฉ ุงูุฃุณุงุณูุฉ ููุซูู.

---

## Sprint ุณุฑูุน 48 ุณุงุนุฉ (ุงูุชุฑุงุญ)

**ุงูููู 1:**
- ุฅุตูุงุญ ุงููุณุงุฑุงุช + ุชูุญูุฏ `server.js`.
- ุชูููุฏ CORS + ุชูุนูู CSP ูุงูุนูุฉ.
- ูุฑุถ `requireAuth` ุนูู `cart/orders/seller`.

**ุงูููู 2:**
- ุชูุนูู S3/Blob ูู `mediaStorage` + ุชูููุน ุงูุฑูุงุจุท.
- ุฅุถุงูุฉ ุงูููุงุฑุณ ุงูุฃุณุงุณูุฉ ูู Mongo + ุถุจุท Pagination.
- ุฅุนุฏุงุฏ Dockerfile + `/healthz` + ุชุดุบูู ุฃูู ูุณุฎุฉ Staging.

---

ูุฐู ุงูุฎุทุฉ ูุชู ุชุญุฏูุซูุง ูุน ุชูุฏู ุงูุชูููุฐุ ููููุตุญ ุจุฑุจุท ูู Sprint ุจุจุทุงูุงุช ููุงู ุฏุงุฎู GitHub Projects / Jira / Trello ููุชุงุจุนุฉ ุงูุชูุฏู.
```

---

ูู ุชุญุจ ุงูุฎุทูุฉ ุงููุงุฏูุฉุ ุฃูุฏุฑ:

* ุฃูุญููู ูู Sprint ุฅูู **ูุงุฆูุฉ Issues ููุชุฑุญุฉ ูู GitHub** (ุนูุงููู + ุฃูุตุงู).
* ุฃู ุฃูุชุจ ูู ููู ุซุงูู ูุซู `docs/SPRINT0_DETAILS.md` ููู ุฃูุงูุฑ ูุชุนุฏููุงุช ูููุงุช ุณุทุฑ ุจุณุทุฑ ูุณุจุฑูุช 0 ููุท.
